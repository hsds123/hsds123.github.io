<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="HSDS123" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="#参考资料：https:&#x2F;&#x2F;support.cumulusnetworks.com&#x2F;hc&#x2F;en-us&#x2F;articles&#x2F;216003057-Configuring-IPv6-Addresses-Other-Than-Static-in-Cumulus-Linux#configuring_an_interface_to_use_ipv6_temporary_addresses http:&#x2F;&#x2F;www.">
<meta name="keywords" content="技术,ipv6">
<meta property="og:type" content="article">
<meta property="og:title" content="IPv6临时地址（隐私模式）">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2018&#x2F;ipv6-temporary-address&#x2F;">
<meta property="og:site_name" content="HSDS123">
<meta property="og:description" content="#参考资料：https:&#x2F;&#x2F;support.cumulusnetworks.com&#x2F;hc&#x2F;en-us&#x2F;articles&#x2F;216003057-Configuring-IPv6-Addresses-Other-Than-Static-in-Cumulus-Linux#configuring_an_interface_to_use_ipv6_temporary_addresses http:&#x2F;&#x2F;www.">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-11-23T04:42:00.000Z">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2018/ipv6-temporary-address/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>IPv6临时地址（隐私模式） | HSDS123</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">HSDS123</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/ipv6-temporary-address/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Huang Sheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HSDS123">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          IPv6临时地址（隐私模式）
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-02 20:00:00" itemprop="dateCreated datePublished" datetime="2018-05-02T20:00:00+08:00">2018-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-23 12:42:00" itemprop="dateModified" datetime="2019-11-23T12:42:00+08:00">2019-11-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>#参考资料：<br><a href="https://support.cumulusnetworks.com/hc/en-us/articles/216003057-Configuring-IPv6-Addresses-Other-Than-Static-in-Cumulus-Linux#configuring_an_interface_to_use_ipv6_temporary_addresses" target="_blank" rel="noopener">https://support.cumulusnetworks.com/hc/en-us/articles/216003057-Configuring-IPv6-Addresses-Other-Than-Static-in-Cumulus-Linux#configuring_an_interface_to_use_ipv6_temporary_addresses</a></p>
<p><a href="http://www.cnblogs.com/makefile/p/5040615.html" target="_blank" rel="noopener">http://www.cnblogs.com/makefile/p/5040615.html</a><br>#查看ipv6地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip -6 addr show ppp0  #显示出指定接口的ipv6</span><br><span class="line">ip -6 addr del 地址A dev ppp0 #或者使用 ifconfig 接口 inet6 del v6地址</span><br></pre></td></tr></table></figure>
<p>查看ipv6临时地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -a | grep tempaddr</span><br><span class="line">    net.ipv6.conf.all.use_tempaddr = 2</span><br><span class="line">    net.ipv6.conf.default.use_tempaddr = 2</span><br><span class="line">    net.ipv6.conf.eth0.use_tempaddr = 2</span><br><span class="line">    net.ipv6.conf.lo.use_tempaddr = 2</span><br></pre></td></tr></table></figure>
<p>修改配置文件：编辑 <code>/etc/sysctl.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">net.ipv6.conf.default.accept_ra=2</span><br><span class="line">net.ipv6.conf.all.accept_ra=2</span><br><span class="line">net.ipv6.conf.default.use_tempaddr=0</span><br><span class="line">net.ipv6.conf.all.use_tempaddr=0</span><br></pre></td></tr></table></figure>

<p>如果要让刚写入的立即也生效可以执行以下<code>sysctl -p</code><br>如果只需要临时生效，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -w net.ipv6.conf.swp1s0.accept_ra=2</span><br><span class="line">sudo sysctl -w net.ipv6.conf.swp1s0.use_tempaddr=2</span><br></pre></td></tr></table></figure>

<h1 id="Ubuntu-18-04-Systemd-networkd"><a href="#Ubuntu-18-04-Systemd-networkd" class="headerlink" title="Ubuntu 18.04 Systemd-networkd"></a>Ubuntu 18.04 Systemd-networkd</h1><p>不知什么原因，以上设置在我Ubuntu 18.04上无效，查了一些资料，最终解决过程如下：<br><a href="https://netplan.io/reference" target="_blank" rel="noopener">https://netplan.io/reference</a></p>
<ol>
<li>编辑netplan的网络配置<br>首先尝试更改<code>nano /etc/netplan/10-ens3.yaml</code><br><code>nano /etc/netplan/10-ens3.yaml</code><br>添加<br><code>ipv6-privacy: yes</code><br>然后尝试应用<br><code>netplan try</code><br>提示<code>unknown key IPv6PrivacyExtensions</code>， 重启结果无法上网了</li>
<li>编剧systemd的网络配置<br><a href="https://wiki.archlinux.org/index.php/IPv6_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#systemd-networkd" target="_blank" rel="noopener">https://wiki.archlinux.org/index.php/IPv6_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#systemd-networkd</a></li>
</ol>
<p><a href="https://www.freedesktop.org/software/systemd/man/systemd.network.html" target="_blank" rel="noopener">https://www.freedesktop.org/software/systemd/man/systemd.network.html</a></p>
<blockquote>
<p>The .network files are read from the files located in the system network directory /usr/lib/systemd/network, the volatile runtime network directory /run/systemd/network and the local administration network directory /etc/systemd/network.<br>[Network] Section Options<br>IPv6PrivacyExtensions=<br>Configures use of stateless temporary addresses that change over time (see RFC 4941, Privacy Extensions for Stateless Address Autoconfiguration in IPv6). Takes a boolean or the special values “prefer-public” and “kernel”. When true, enables the privacy extensions and prefers temporary addresses over public addresses. When “prefer-public”, enables the privacy extensions, but prefers public addresses over temporary addresses. When false, the privacy extensions remain disabled. When “kernel”, the kernel’s default setting will be left in place. Defaults to “no”.</p>
</blockquote>
<p>编辑（创建）/etc/systemd/network/10-netplan-ens3.network<br><code>nano /etc/systemd/network/10-netplan-ens3.network</code><br>写入以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Match]</span><br><span class="line">Name=ens3</span><br><span class="line"></span><br><span class="line">[Network]</span><br><span class="line">DHCP=ipv4</span><br><span class="line">LinkLocalAddressing=ipv6</span><br><span class="line">IPv6PrivacyExtensions=kernel</span><br><span class="line"></span><br><span class="line">[DHCP]</span><br><span class="line">UseMTU=true</span><br><span class="line">RouteMetric=100</span><br></pre></td></tr></table></figure>
<p>注意，以上<code>DHCP=ipv4</code>也必不可少，<strong>否则无法获得ipv4地址</strong>！</p>
<p>保存之后重启网络服务（不行就重启系统）：<br><code>systemctl restart systemd-networkd</code></p>
<p>问题得以解决。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%8A%80%E6%9C%AF/" rel="tag"># 技术</a>
              <a href="/tags/ipv6/" rel="tag"># ipv6</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2017/VPS-SS-libev/" rel="next" title="Shadowsocks-libev">
                  <i class="fa fa-chevron-left"></i> Shadowsocks-libev
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2018/Firefox-add-password/" rel="prev" title="Firefox手动添加密码">
                  Firefox手动添加密码 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Ubuntu-18-04-Systemd-networkd"><span class="nav-number">1.</span> <span class="nav-text">Ubuntu 18.04 Systemd-networkd</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Huang Sheng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Huang Sheng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.5.0
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  

</body>
</html>
